<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>TCC</title>

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- CSS code from Bootply.com editor -->


  <!-- Custom styles for this template -->


  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="js/ie8-responsive-file-warning.js"></script><![endif]-->


  <style>
  body {
    padding-top: 50px;
  }
  .starter-template {
    padding: 40px 15px;
    text-align: center;
  }
  </style>


  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="js/index.js"></script>
 <script>  

    function getsessions(){
      $('span#disciplina').empty();
      $('span#disciplina').append("Aguarde...");
      $('span#serie').empty();
      $('span#serie').append("Aguarde...");
      $('span#turma').empty();
      $('span#turma').append("Aguarde...");

      $.ajax({
        type: "POST",
        url: 'http://localhost/projetos/TCC_WEBSERVICE/inicio/getSessions',
        ContentType:"application/json; charset=utf-8",
        dataType: "json",
        success: function(data)
        {
          $.each(data, function(i, item)
          {
            $('span#disciplina').empty();
            $('span#disciplina').append(data[i].disciplina);
            $('span#serie').empty();
            $('span#serie').append(data[i].serie);
            $('span#turma').empty();
            $('span#turma').append(data[i].turma);
          });
        },
        complete : function()
        {

        }
      });

    }

    function listaalunos(){

      var linhainicial;

      linhainicial = "<tr><td>Aguarde...</td><td>Aguarde...</td></tr>";

      $("#lista_alunos").empty();
      $("#lista_alunos").append(linhainicial);

      $.ajax({
        type: "POST",
        url: 'http://localhost/projetos/TCC_WEBSERVICE/inicio/getalunos',
        ContentType:"application/json; charset=utf-8",
        dataType: "json",
        success: function(data)
        {
          $("#lista_alunos").empty();
          $.each(data, function(i, item)
          {

            linhainicial = "<tr><td>"+data[i].nome+"</td><td><input name='chk_presenca[]' type='checkbox' class='chk_presenca' id='chk_presenca' value='"+data[i].id+"' /></td></tr>";
            
            $("#lista_alunos").append(linhainicial);
          });
        },
        complete : function()
        {

        }
      });
    }

    function salvarPresenca(){

      var datapresenca;

      var chk_presenca = new Array();

      $("input[name='chk_presenca[]']:checked").each(function(i) {
         chk_presenca[i] = $(this).val();
      });

      datapresenca = $('#input_date').val();

      $.ajax({

        type: 'POST',
        url: 'http://localhost/projetos/TCC_WEBSERVICE/inicio/salvaPresenca',
        data: {
          datapresenca: datapresenca,
          chk_presenca: chk_presenca
        },
        success : function(data){
          if (data == '1') {
            $("#myResponse").html('<div class="alert alert-success" role="alert">Presença inserida com sucesso! <a href="principal.html" class="alert-link">Voltar</a></div>');
          }else{
            $("#myResponse").html('<div class="alert alert-danger" role="alert">Houve algum erro durante a inserção!</div>');
          };
          
        }

      });

      return false;
    }

    function verificaData(){
      var data = $('#input_date').val();

      if (data == '') {
        alert ('Preencha a data que será lançada a presença!');
        return false;
      }else{
        salvarPresenca();
      };
    }

    $(document).ready(function(){
      getsessions();
      listaalunos();
      $('#lancar_presenca').click(function(){
        verificaData();
      });
    });
    </script>
</head>

<body>
 <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
   <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
     <span class="sr-only">Toggle navigation</span>
     <span class="icon-bar"></span>
     <span class="icon-bar"></span>
     <span class="icon-bar"></span>
   </button>
   <a class="navbar-brand" href="#">Diario Eletrônico</a>
 </div>
 <div id="navbar" class="collapse navbar-collapse">
  <ul class="nav navbar-nav">
   <li><a href="principal.html">Inicio</a></li>
   <li><a href="sobre.html">Sobre</a></li>
   <li><a href="index.html">Sair</a></li>
 </ul>
</div><!--/.nav-collapse -->
</div>
</nav>
<div class="starter-template">
  <h4>Escolha uma data para presença</h4>
  <input type="date" id="input_date" class="form-control">
  <br>
  <div class="panel panel-warning">
   <div class="panel-heading">Atenção</div>
   <div class="panel-body">
    <p>As informações abaixo são referentes aos filtros: <br>
     <b>Disciplina:</b> <span id="disciplina"></span><br>
     <b>Serie:</b>
     <span id="serie"></span>
     <br>
     <b>Turma:</b>
     <span id="turma"></span>
     <br>
   </p>
 </div>
</div>
<br>
<table class="table table-striped">
 <thead>
  <tr>

   <th class="text-center">Aluno</th>
   <th class="text-center">Presença</th>
 </tr>
</thead>
<form action="" name="presenca" id="form_presenca" method="post">
<tbody id="lista_alunos">
</tbody>
</form>
<tr>
 <td colspan="3">           
  <a class="btn btn-primary btn-lg btn-block" href="#" id="lancar_presenca" role="button">Lançar Presença</a>
  <a class="btn btn-default btn-lg btn-block" href="principal.html" role="button">Cancelar</a>
</td>
</tr>
</table>
</div>
<div id="myResponse" class=""></div>



<!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->

</body>
</html>
